service: maison-inspect 

image: nachiket87/maison-inspect

servers:
  - 138.197.144.125

registry:
  username: nachiket87
  password:
    - KAMAL_REGISTRY_PASSWORD

env:
 clear:
   DB_HOST: 138.197.144.125
 secret:
   - RAILS_MASTER_KEY
   - MAISONINSPECT_DATABASE_PASSWORD

 accessories:
   db:
     image: postgres:15
     host: 138.197.144.125
     port: 5432
     env:
       secret:
         - MAISONINSPECT_DATABASE_PASSWORD
       clear:
         POSTGRES_DB: 'maisoninspect_production'
         POSTGRES_USER: 'maison_inspect'
     files:
       - db/production.sql:/docker-entrypoint-initdb.d/setup.sql
     directories:
       - data:/var/lib/postgresql/data
